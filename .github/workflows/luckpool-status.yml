name: Verus Worker Status Monitor (5 menit)

on:
  schedule:
    - cron: "*/5 * * * *"  # Setiap 5 menit
  workflow_dispatch:

jobs:
  check-status:
    runs-on: ubuntu-latest

    steps:
      - name: Cek status Luckpool & kirim Telegram
        run: |
          WALLET="RGVmtuvrP2yX8q3U4up77CcSpkcVhp4bUG"
          TELEGRAM_TOKEN="7548058927:AAF-fL3P6W5sNxbzbmwwtsfVxPZubdIybzc"
          TELEGRAM_CHAT_ID="5763229296"

          # Ambil data dari API Luckpool
          DATA=$(curl -s "https://luckpool.net/api/miner/$WALLET")

          if echo "$DATA" | grep -q "worker_hashes"; then
            WORKERS=$(echo "$DATA" | jq -r '.worker_hashes | to_entries[] | "\(.key): \(.value) H/s"' | sed ':a;N;$!ba;s/\n/\\n/g')
            TOTAL_HASHRATE=$(echo "$DATA" | jq -r '.hashrate')
            MESSAGE="üí† *Active Workers (Luckpool)*\n$WORKERS\n\nüìä Total Hashrate: *${TOTAL_HASHRATE}* H/s"
          else
            MESSAGE="‚ö†Ô∏è *No active workers found* for \`$WALLET\`"
          fi

          # Kirim ke Telegram
          curl -s -X POST https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage \
            -d chat_id=$TELEGRAM_CHAT_ID \
            -d parse_mode=Markdown \
            -d text="$MESSAGE"
