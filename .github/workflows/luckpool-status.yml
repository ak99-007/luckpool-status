name: Cek Status Worker Verus di Luckpool

on:
  schedule:
    - cron: "*/5 * * * *"  # Setiap 5 menit
  workflow_dispatch:

jobs:
  check-luckpool-status:
    runs-on: ubuntu-latest

    steps:
      - name: Install curl & jq
        run: sudo apt update && sudo apt install -y curl jq

      - name: Cek status & kirim Telegram
        run: |
          # === Konfigurasi ===
          TELEGRAM_TOKEN="7548058927:AAF-fL3P6W5sNxbzbmwwtsfVxPZubdIybzc"
          TELEGRAM_CHAT_ID="5763229296"
          WALLET="RGVmtuvrP2yX8q3U4up77CcSpkcVhp4bUG"

          # Ambil data dari Luckpool
          DATA=$(curl -s "https://luckpool.net/api/miner_stats?address=$WALLET")

          if [ -z "$DATA" ] || echo "$DATA" | grep -q "error"; then
            MSG="‚ùå Gagal mengambil data dari Luckpool untuk wallet: $WALLET"
          else
            HASHRATE=$(echo "$DATA" | jq -r '.hashrate')
            BALANCE=$(echo "$DATA" | jq -r '.balance')
            IMMATURE=$(echo "$DATA" | jq -r '.immature')

            WORKERS=$(echo "$DATA" | jq -r '.workers | keys[]')
            MSG="üîç *Status Mining Luckpool*\n\nüíº Wallet: \`$WALLET\`\n‚ö° Hashrate: *${HASHRATE} kH/s*\nüí∞ Balance: *${BALANCE} VRSC*\nüß™ Immature: *${IMMATURE} VRSC*\n\nüë∑ *Workers Aktif:*"

            for WORKER in $WORKERS; do
              WR_HASH=$(echo "$DATA" | jq -r ".workers[\"$WORKER\"].hashrate")
              WR_SHARE=$(echo "$DATA" | jq -r ".workers[\"$WORKER\"].lastshare")
              WR_TIME=$(date -d "@$WR_SHARE" "+%H:%M:%S")
              MSG+="\nüî∏ \`$WORKER\` ‚Äî ${WR_HASH} kH/s, last share $WR_TIME"
            done
          fi

          curl -s -X POST "https://api.telegram.org/bot$TELEGRAM_TOKEN/sendMessage" \
            -d chat_id="$TELEGRAM_CHAT_ID" \
            -d parse_mode="Markdown" \
            -d text="$MSG"
